# 技術力評価会　評価結果

* 被評価者: DIGITALIO 小林 彩花
* 評価者: fluct 井手上 雅迪

[評価資料](./digitalio_a-kobayashi/README.md)

## 総評

自分の意思で多くの決断をして、プロジェクトを前に進めていたところが良かったです。決断するということは勇気がいることですが、ひとつずつそれを積み重ねることができるという能力は、プロジェクトマネジメントやエンジニアリングに必要な事だと思います。本質的にどういう課題を解かないといけないのか意識して進めることができるようになると、プロジェクト進行を安心して任せられるという状態になりそうです。

技術的なノウハウの面では、DB設計が将来のユースケースを本当にカバーできるという自信をあんまり持てませんでした。たくさんコードを書いたり、学ぶ時間を確保するなどスキルアップにトライしてください。

## 評価者が被評価者の状況ならこう考える、こう動く

### プロジェクト・プロダクトマネジメント

#### 何を実現すべきだったのかを切り出し、制約を取り払う

検索コンテンツで減った分の獲得ポイントを埋めるためなら、ユーザーにとってはアンケートじゃなくても良かったと思います。その上であえてアンケートにするということは古い登録情報の更新や、ユーザーデータ利活用など、それ以外の思惑がうまくいくかどうかが重要であるということです。そこの自信がないまま進めることは「それ以外の思惑」については成功率が低い状態です。

ユースケースが見えない状態で考えた設計は、めちゃくちゃうまい抽象化ができていない限りは砂上の楼閣です。もしあったなら、別なコンテンツにピボットするところに立ち戻っても良かったのかなと思いました。

### DB 周り

#### 変更にコストが掛かりそうなところ

不確実性の高いプロジェクトなので、将来的にどうにでもなることが設計方針のひとつだったと思います。頑張ればどうにでもなるとは思いますが、以下の質問に答える場合は手動オペレーションが増えて変更コストが上がったり、オペレーションミスの危険性があるなと思いました。

##### 時事問題に対する意識調査をしたい場合、優先度の高い質問を挟むにはどうすればいいでしょうか

`display_order` はunique制約があるわけでもないので、何らかのルートで同じdisplay_orderの質問が出てきたら、今の実装だと一生表示されない質問が出てくると思います。①それに気付けるでしょうか。②時事問題に対する意識調査をしたい場合、優先度の高い質問を挟むにはどうすればいいでしょうか。

今の実装だと、①は回答されない質問がないか定期的にチェックすること、②はユーザーごとに`enquete_rally_last_answer.enquete_rally_question_id`が違うので、実現はけっこう大変だと思います。

display_orderではなく、表示優先度による重みを導入するのはどうでしょうか。ユーザーがまだ回答していない質問で、最も優先度が高いものを出す形です。

1. ユーザーが回答済みかどうかは（データが削除されない前提で）`enquete_rally_answer_log`か、ユーザー&質問ごとに回答済みかどうかを管理するテーブルを使用
2. 回答済みでない重みの高いアンケートを表示、同じ重みのアンケートはランダムに選択
3. 緊急度の高い質問は重みを増やして追加する

##### 2ポイント付与する日を5日目から7日目にしたいときはどうしますか

少なくとも`answer_count`は5の剰余でリセットする必要はありそうです。14問目を回答していたユーザーがいたとして、5日目ボーナスまであと1日なのに7日ボーナスになった途端、1問目からやり直しになりそうです。

この方法でも、5日目を目指して回答していたユーザーが途中で7日目ボーナスになってがっかりする可能性がありそうです。今、ユーザーAは5日周期の3日目にいるなど、周期をモデルとして組み込むのはどうでしょうか。

### その他、あんまりやらないかなという設計

#### typeや状態を文字列で表現する

`multiple-answer/single-answer` などの部分。文字列だとその２つ以外の文字列を入れ込むことが可能です。enumでやる場合はサーティーワンフレーバーパターンになります。`input_type`を表現するための参照テーブルを用意しておくのはどうでしょうか。

#### is_displayを使わない方法はあるか

論理削除の話に近いです。アンケート表示先が増えた場合やアンケート管理画面ができたとき、どこの画面に表示するフラグなのか混乱は生じないでしょうか？
物理削除もあり得ると思います。しかし、`enquete_rally_last_answer.enquete_rally_question_id`を参照しているから物理削除が難しそうですね。その場合はなぜこの参照が必要になったのかを考えてみるといいかもです。display_orderのところにある、ユーザー&質問ごとの回答済み管理の話につながるかもしれません。

#### 参照があるときと無いときがある

`enquete_rally_answer_field_log.enquete_rally_question_field_id` は名前的に`enquete_rally_question_field.id`を指すと思われますが、参照制約が無いことに驚きました。
これはたぶん`enquete_rally_answer_field_log.enquete_rally_question_field_id`がゼロであることを許容したいのかと思います。
ゼロ以外は他テーブル行への参照なのに、ゼロだけ特別な意味を持たせるというようなことは止めたほうが良いです。アプリケーションコードやコメントを読まないと読み取れない仕様です。
参照制約が無いことにも気付きやすいカラム名だといいかもしれません。

### API

#### 空のデータに意味を複数持たせない

DBの「参照があるときと無いときがある」にも近いですが、APIのレスポンスで、question空であること自体に複数の意味をもたせています。

* 次の質問が本当に質問がない
* リセット待ち

これを区別できるようにしておくと、フロント実装者もレスポンスだけ見てどのような状況なのか判断できますし、フロントでの表示分けなどに備えることができます。
ステータスやエラーの定義をしてあげるのが良さそうです。

## 能力向上に関するアドバイス

引き続き、自分で情報を集めてたくさんの決断をしてください。そしてその決断の質を上げてください。この辺りは、行動を見ていると自ずとできるようになってくるように思えたので、数をこなしてください。

コードもたくさん書きましょう。設計もたくさん悩んで学びましょう。そのような時間をとれるようにしてみましょう。
特にDB周りのアンチパターンなどの学習は、まだまだ使える知識だと思うので体系的に見ておくと良いかなと思いました。
良いAPIの作り方もよければ調べてみてください。

## 細かいポイント

* 良かった
	* 成果物の広告収入としての黒字化
  * 大体のところはなぜそうしたかが返ってくる
  * Next.jsできる人とペアプロをして学ぶ
  * チームやプロジェクトの振り返り
  * 法務確認のアクション
* 気になった
  * テストでスパイを使っている箇所が多い
    * 間接的な確認なので変更に弱い
  * 事業部の方針という言葉がいくつかあったが、どう受け止めてほしいのか
