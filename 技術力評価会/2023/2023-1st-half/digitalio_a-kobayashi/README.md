# 新毎日貯まるコンテンツの企画・設計・実装

- 開催日
  - 4月 19日 (水曜日)⋅午後3:00～4:30
- 評価者
  - 井手上 雅迪さん
  - 淺原 万貴さん
- 評価対象者
  - 小林 彩花  
  - 所属
    - 株式会社DIGITALIO ポイントメディア事業本部  
  - グレード
    - E2

## 概要

- 新しく毎日貯まるコンテンツを作成した。
- next.jsでのフロントエンドを作成するという事業部での方針にも沿って、新コンテンツを１からnextで作る実績ができた。
- 要望としてもあった、鮮度の高いユーザデータの収集が出来るようになったので、今後は分析やセグメント配信に役立てる事ができるデータが蓄積されていっている。

## 用語

- ECナビ  
  - https://ecnavi.jp/
  - 運営: 株式会社DIGITALIO
  - アフィリエイトなどでポイントを貯めることが出来るサービス。貯めたポイントはPeXへ交換し各種ギフト券などへ交換可能。

- 毎日貯まるコンテンツ
  -　<img width="1299" alt="image" src="https://user-images.githubusercontent.com/39899014/230766183-6278c4cd-7f2b-452b-b8fc-994e5f10a68f.png">
  - ECナビ上にある毎日数ポイントを獲得できるコンテンツ郡の総称
  - ユーザの訪問率を上げるためや、サービスのコンテンツ性を向上する目的の立ち位置

- 検索コンテンツ
  - 毎日貯まるコンテンツのうちの1つであり、その中でも種類はいくつかあるが、全て何かしらの検索をするとポイント取得可能という仕様である。
    - PC辞書検索: 1日2ポイント獲得可能。
    - SP辞書検索: 1日1ポイント獲得可能。
    - 検索募金: 1日1ポイント獲得可能。
  - ADNW収益で賄えず、ユーザーにとっても特に意味のないクリックを繰り返すコンテンツになってしまっていた。

## 事業部的背景

このコンテンツをやりたい要素として、2軸あった。

#### 1. 「削除されるコンテンツの代わりとして新しく何かしらのコンテンツを毎日貯まるに入れたい」
ECナビでは、ユーザに向けた販促系サービスとしていくつかのコンテンツを運営している。  
古くからあるコンテンツの中には、現在の状況において不採算なものがあった。  
不採算コンテンツである、検索コンテンツを無くす変わりに、「ポイント獲得できるコンテンツが減少する」といったネガティブイメージを回避する為、新しく毎日貯まるコンテンツを作りたいという要望があった。
また、辞書検索は2月末に削除予定だったので、ユーザが獲得できるポイントが減らないように2月末くらいにはリリースしたいという強い要望があった。

今回2つ新しく毎日貯まるコンテンツを作る事になったが、もう1つである「毎日占い」の方がスケジュールに遅れが出て、1月頭目標だったところを2月頭になったため、自分の担当するタスクは遅れられない状況だった。

<img width="684" alt="image" src="https://user-images.githubusercontent.com/39899014/231434992-dcc04e23-e248-41e3-bce1-53a236ed35cc.png">

#### 2. 「鮮度の高いユーザデータの収集が出来るシステムが欲しい」

これまではユーザのデータは詳細に取得することが出来ていなかった。  
理由としてはユーザ登録時の簡略化を進め、より新規獲得しやすい方針で進めている為、詳細なデータ収集とはトレードオフな関係にあったため。  


<details><summary>会員登録時</summary>

<img width="276" alt="image" src="https://user-images.githubusercontent.com/39899014/231435561-ee97371b-1401-46d1-96c5-9af214564791.png">

</details>


<details><summary>基本情報登録ページ</summary>

下記の主に任意項目部分のように、会員登録時にない項目もある。

<img width="276" alt="image" src="https://user-images.githubusercontent.com/39899014/231436202-59fb356f-4b43-48c5-916c-67dcf4626c38.png">

</details>

ECナビでの活用方法で言えば、メール配信やアンケート配信におけるセグメントに役立てることが出来る。    
また、外部提供の目線も考えれば、ECナビのユーザに対してアンケートを取る際に対象を絞って必要十分にやれることは魅力となる。   
また、各種分析を行う際にユーザデータが充実していると施策等の考えられる幅が格段に広がる。   
上記の理由から、ユーザデータを収集するコンテンツを作りたいといった要望があった。 
また、使用用途を想定すると、集めるデータは定期的に更新される物 = 鮮度の高いデータがいいといった要望も強かった。


## 体制
### PJメンバー

- 川ちゃんさん
  - データアナリスト
  - コンテンツの草案考案人・初期のPJディレクター
  - データの用意・法務確認等を担当
- 安藤さん
  - 途中からディレクターとして入ってもらった
  - スケジュールの管理を担当
- 池田さん
  - デザイナーさん
  - クリエイティブやコンポーネントの作成を担当

### チーム

[@g_pm_engineer_t](https://app.slack.com/client/T024G4NMH/C03MRKE8ECW/user_groups/SHM81K867)

- gorinya
- yossy
  - ペアプロをお願いしたり、レビューをお願いした
- guri
  - ボナ休後引き継ぎをお願いした

## スケジュール

- 2022/11　上旬頃: キックオフ
- 2022/12　下旬頃: 作成するコンテンツの要件が確定していく
- 2022/1   上旬~: DB設計・作成
- 2022/1   中旬~: API作成
- 2022/1   下旬~: フロントエンド作成
- 2022/2　　下旬: リリース

## 成果物

※ 以降出てくるPRの中で、特にコアな部分/目を通してもらいたいものは★をつけてある。

### issue

- アンケートラリー
  - https://ecnavi.jp/contents/enquete_rally/

- 仕様まとめ
  - https://github.com/voyagegroup/ecnavi/issues/15048#issuecomment-1336886798

  登場人物は下記の様な関係  
  <img width="647" alt="image" src="https://user-images.githubusercontent.com/39899014/231441884-7df02b7a-1c61-4baa-9b86-439ac504a8b5.png">

- 意識したこと
  - データの利用時を考えようにも、ユーザデータの収集コンテンツの構想はまだ出来ていなかった
  - なくなるコンテンツの代わりとするには、2月末くらいにはリリースしたかった
  - 後からどうにでも扱えるようなデータの持たせ方をするとして、やることの整理を進めていった
  - やらないこと/後回しにすることを明確化して細かく着手していった

### PJメンバーとして
  - 最初期は2名だけだったが、方針の決定・促進をした
    - 特に初期は、何のために使うデータなのか？という話が膨らみすぎて、収集がつかなくなりそうになっていった。
そちらに関しては別PJとして切り分けて、今回のスコープはコンテンツ作成だけにするといった提案をした。
    - 各人の役割分担を決め、質問の作成や、またそれに関する法務確認等を依頼したり、デザイナーとの担当部分を決めていった。
  - [スケジュールのスプレッドシート](https://docs.google.com/spreadsheets/d/1kbAUS4S8ovpBHo77mDcNM2_UrVqwMaECidga1up_nP0/edit#gid=310600085)を用意して、お互いが何をやってるのかをわかりやすくするように提案した。
  - 都度PJ自体の進め方を議題に上げ、途中での安藤さん加入やMTGの頻度を変えていった
  - MTGでこまめに共有しPJメンバーとの認識を合わせた
  - チームに対して、設計時にレビューを依頼したり、ペアプロを依頼したり周りを頼ってスピード・質を担保した
  - KPTの実施やtryの促進を積極的に行い、その結果もチームに共有した。

###  DB
- 制作物
  - ★[テーブル郡作成](https://github.com/voyagegroup/ecnavi-db/pull/929)
- 意識したこと
  - 毎日貯まるコンテンツのトップアクセスのものは、DAUで14万弱
  - ログデータとして持たせるものはパーティションを切って定期削除していく事にした
    - ポイントメディアでのDB運用としても推奨されている
  - 回答に時間があきログデータが消えてしまっても、ユーザは以前の回答を引き継いで再度始めることが出来るような設計にした
  - 管理画面は今回作らず、直接DBに入れたが、時間制約を考え最初は10問いれておき、その後はスプレッドシートを元にマクロを組んでクエリ発行してDBにinsertしていった。
    - [質問一覧スプレッドシート](https://docs.google.com/spreadsheets/d/1vN4R5IDM2hSoDWSpn3J809dKxQDz42JvmFE_J_0bVuQ/edit?pli=1#gid=2029428565)
    - [作成したマクロ](https://script.google.com/home/projects/1wPJk731Fqf3pfnVwlA3dFuYEEeK8_j8zzhwG-DyNw20Jr-P79O9fvgYU/edit)
    - [挿入時のクエリレビューissue一例](https://gitlab.voyagegr.info/ecnavi/ecnavi-prod-data/issues/411)

### API作成
- 制作物
  - ★[質問取得のAPI作成](https://github.com/voyagegroup/ecnavi/pull/15342)
  - ★[回答APIの作成](https://github.com/voyagegroup/ecnavi/pull/15346)
  - [ポイント取得ステップを返すAPI作成](https://github.com/voyagegroup/ecnavi/pull/15446)
  - [回答ステータスを返すAPI作成](https://github.com/voyagegroup/ecnavi/pull/15557)
- 意識したこと
  - 多重アクセスでの不正ポイント獲得は出来ないようにバリデーション、DB制約で弾けるようにした
  - 債務をできるだけ切り分けて、なるべくクラスごとに1つの要素に関する事しか行わないように意識した

### フロントエンド
- 制作物
  - ★[質問の取得・表示まで](https://github.com/voyagegroup/ecnavi/pull/15389)
  - ★[回答するところまで](https://github.com/voyagegroup/ecnavi/pull/15502)
  - [回答後のページ表示](https://github.com/voyagegroup/ecnavi/pull/15507)
- 意識したこと
  - フロント初挑戦だったので、ペアプロをチームメンバーに依頼してスピードを保った
  - next.jsで書かれるフロントがシンプルなコンテンツとして実績が出来た。

## 結果

https://github.com/voyagegroup/ecnavi/issues/15048#issuecomment-1461462776
<img width="1043" alt="image" src="https://user-images.githubusercontent.com/39899014/230800221-ef979983-5e1d-40de-94f8-18720885ca21.png">
上位のDAUとなり、ユーザに使ってもらえている

コンテンツに関する細かい数字は下記  
https://redash.voyagegr.net/dashboard/-_137?p_w4000_enquete_rally_question_id=2  
ポイントを付与しない仕様からか、「回答しない」を選ぶ人もとても少ない。

今後は別PJとしてユーザデータを活用していく取り組みも有り、分析やセグメント配信に役立てる際にデータ活用することが出来る。
また、2月末にリリースすることが出来たのでポイント取得コンテンツが減少するというユーザにとっての改悪イメージは逃れられたかと思う。

チームに対しても、KPTのFBを行い、現在行われている場所では振り返りを活かして検証の一覧を予め羅列しておく、といった取り組みが実際に採用されている。
